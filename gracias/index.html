<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gracias por tu compra ¬∑ Sabores del Fog√≥n</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="icon" href="/images/LOGO96.webp">

<style>
:root{
  --bg:#0f0f0f;
  --card:#1b1b1b;
  --text:#cfcac2;
  --muted:#9a958d;
  --accent:#D3AE09;
}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}
.container{
  max-width:720px;
  margin:auto;
  padding:16px;
  padding-top:72px;
}
.mini-banner{
  position:fixed;
  top:12px;
  left:12px;
  right:12px;
  height:48px;
  background:#1b1b1b;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 12px;
  z-index:10;
}
.mini-banner img{width:36px}
.mini-banner a{
  color:#fff;
  text-decoration:none;
  font-size:13px;
}
.section{
  background:var(--card);
  border-radius:14px;
  padding:20px;
  margin-bottom:16px;
}
h1{
  color:var(--accent);
  font-size:22px;
  margin-bottom:8px;
}
.muted{
  color:var(--muted);
  font-size:14px;
}
.list{
  font-size:14px;
  line-height:1.6;
}
.total{
  font-size:18px;
  font-weight:600;
  margin-top:14px;
}
.btn{
  display:block;
  margin-top:16px;
  padding:14px;
  background:var(--accent);
  color:#2a2a2a;
  text-align:center;
  border-radius:10px;
  font-weight:600;
  text-decoration:none;
}
.center{text-align:center}
</style>
</head>

<body>

<div class="mini-banner">
  <div>
    <img src="/images/LOGO.webp">
  </div>
  <a href="https://www.instagram.com/saboresfogon.ar/" target="_blank">
    @saboresfogon.ar
  </a>
</div>

<div class="container">

  <!-- ===== ESTADO ===== -->
  <div class="section center">
    <h1>¬°Gracias por tu compra! ü•©üßÄ</h1>
    <p class="muted" id="statusText">Estamos confirmando tu pago‚Ä¶</p>
    <p class="muted" id="orderId"></p>
  </div>

  <!-- ===== DETALLES ===== -->
  <div class="section" id="details" style="display:none">
    <div class="list" id="orderSummary"></div>

    <div class="list" id="deliveryInfo" style="margin-top:12px"></div>

    <div class="total" id="total"></div>

    <p class="muted" style="margin-top:14px">
      üïí En breve uno de nuestros agentes se va a comunicar con vos por WhatsApp
      para coordinar el horario de entrega.
    </p>
  </div>

  <a class="btn" href="https://www.instagram.com/saboresfogon.ar/" target="_blank">
    Volver a Instagram
  </a>

</div>

<script>
const params = new URLSearchParams(location.search);
const orderId =
  params.get("external_reference") ||
  sessionStorage.getItem("order_id");

if (orderId) {
  document.getElementById("orderId").innerHTML =
    "Pedido <b>" + orderId + "</b>";
}

async function loadOrder() {
  if (!orderId) return;

  const res = await fetch(
    "/api/order/details?order_id=" + encodeURIComponent(orderId)
  );

  const data = await res.json();

  if (data.status !== "confirmed") {
    document.getElementById("statusText").innerText =
      "Tu pago est√° siendo confirmado‚Ä¶";
    setTimeout(loadOrder, 2000);
    return;
  }

  // ‚úÖ pago confirmado
  document.getElementById("statusText").innerText =
    "Pago confirmado correctamente ‚úÖ";

  // ===== RESUMEN =====
  const summary = document.getElementById("orderSummary");

  summary.innerHTML = `
    <b>Resumen de tu pedido</b><br><br>
    ‚Ä¢ Cantidad de picadas: <b>${data.items.length}</b><br><br>
    ${data.items.map((p, i) =>
      `‚Ä¢ Picada ${i + 1}: ${p.model} (${p.size} personas)`
    ).join("<br>")}
  `;

  // ===== ENV√çO =====
  const delivery = document.getElementById("deliveryInfo");

  delivery.innerHTML = `
    <b>üìç Direcci√≥n de entrega</b><br>
    ${data.zone || "-"}${data.address ? " ‚Äì " + data.address : ""}
  `;

  // ===== TOTAL =====
  document.getElementById("total").innerHTML =
    "Total pagado: $" + data.total.toLocaleString();

  document.getElementById("details").style.display = "block";

  // üî• limpiar estado del pedido
  try{
    localStorage.clear();
    sessionStorage.clear();
  }catch(e){}
}

loadOrder();
</script>

</body>
</html>
